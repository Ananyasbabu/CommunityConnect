<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <title>Create Help Request | CommunityConnect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />
  <!-- Custom CSS -->
  <style>
    :root {
      --cc-bg: #0f172a; /* dark slate */
      --cc-accent: #0d6efd; /* bootstrap primary */
      --cc-soft: #f8fafc; /* light surface */
      --cc-muted: #6c757d;
    }
    body {
      background: #ffffff;
    }
    .navbar {
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    }
    .hero-section {
      background: linear-gradient(135deg, #501221 0%, #7f69a2 100%);
      color: #fff;
      padding: 48px 0;
      text-align: center;
    }
    .hero-section h1 {
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    .page-card {
      background: #fff;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
    }
    .section-title {
      font-weight: 700;
    }
    .form-label {
      font-weight: 600;
    }
    .hint {
      font-size: 0.9rem;
      color: var(--cc-muted);
    }
    .map-wrap {
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 0.75rem;
      overflow: hidden;
      background: var(--cc-soft);
    }
    #map {
      width: 100%;
      height: 380px;
      border-radius: 0.75rem;
    }
    .badge-legend .badge {
      font-size: 0.8rem;
    }
    .required::after {
      content: " *";
      color: #dc3545;
    }
    footer {
      margin-top: 48px;
    }
  </style>
</head>
<body>
  <!-- Nav -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
    <img src="favicon.ico" alt="Logo" width="50" height="50" />
    <span style="margin-left: 10px; font-size: 20px; font-weight: bold"
      >Community Connect</span
    >
    <div class="ms-auto d-flex gap-2">
      <a href="index.html" class="btn btn-outline-light">Home</a>
      <a href="login.html" class="btn btn-outline-light">Login</a>
    </div>
  </nav>

  <!-- Hero -->
  <header class="hero-section">
    <div class="container">
      <h1>Create Help Request</h1>
      <p class="mb-0">
        Post a request so nearby volunteers can find and assist you quickly.
      </p>
    </div>
  </header>

  <!-- Content -->
  <main class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-9">
        <div class="page-card p-4 p-md-5">
          <h2 class="section-title mb-4">Request Details</h2>

          <!-- Alert placeholder -->
          <div id="formAlert" class="alert d-none" role="alert"></div>

          <form id="helpRequestForm" novalidate>
            <div class="row g-4">
              <div class="col-md-8">
                <label class="form-label required" for="title">Title</label>
                <input
                  class="form-control"
                  id="title"
                  name="title"
                  type="text"
                  placeholder="e.g., Urgent O+ Blood Needed at KIMS Hospital"
                  required
                  maxlength="120"
                />
                <div class="hint mt-1">Keep it clear and concise.</div>
              </div>

              <div class="col-md-4">
                <label class="form-label required" for="category">Category</label>
                <select class="form-select" id="category" name="category" required>
                  <option value="">Select</option>
                  <option>Blood</option>
                  <option>Food</option>
                  <option>Rescue</option>
                  <option>Lost &amp; Found</option>
                  <option>Other</option>
                </select>
              </div>

              <div class="col-12">
                <label class="form-label required" for="description">Description</label>
                <textarea
                  class="form-control"
                  id="description"
                  name="description"
                  rows="5"
                  placeholder="Share the details: who needs help, what exactly is needed, any time constraints, etc."
                  required
                ></textarea>
                <div class="hint mt-1">Avoid sharing sensitive personal info.</div>
              </div>

              <div class="col-md-6">
                <label class="form-label required" for="contact">Contact</label>
                <input
                  class="form-control"
                  id="contact"
                  name="contact"
                  type="text"
                  placeholder="Phone or email"
                  required
                  maxlength="80"
                />
                <div class="hint mt-1">This will be visible on the post.</div>
              </div>

              <div class="col-md-6">
                <label class="form-label" for="address">Address / Landmark</label>
                <input
                  class="form-control"
                  id="address"
                  name="address"
                  type="text"
                  placeholder="Optional: Hospital name, street, area"
                />
              </div>

              <div class="col-12">
                <label class="form-label required">Pick Location on Map</label>
                <div class="map-wrap">
                  <div id="map"></div>
                </div>
                <div
                  class="d-flex align-items-center justify-content-between mt-2"
                >
                  <small class="hint">
                    Click the map to place/move the pin. Latitude and longitude
                    are auto-filled.
                  </small>
                  <div class="badge-legend">
                    <span class="badge bg-primary">Request Location</span>
                  </div>
                </div>
                <input type="hidden" id="latitude" name="latitude" />
                <input type="hidden" id="longitude" name="longitude" />
              </div>

              <div class="col-12 d-flex gap-3 mt-2">
                <button type="submit" class="btn btn-primary">Submit Request</button>
                <button type="reset" class="btn btn-outline-secondary" id="resetBtn">
                  Reset
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-dark text-white text-center p-3">
    &copy; 2025 CommunityConnect | Local Help Portal
  </footer>

  <!-- Bootstrap JS (optional, for nicer behavior) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Page Script -->
  <script>
    let map, marker;

    function setLatLng(lat, lng) {
      document.getElementById("latitude").value = lat.toFixed(6);
      document.getElementById("longitude").value = lng.toFixed(6);
    }

    function placeMarker(latLng) {
      marker.setPosition(latLng);
      setLatLng(latLng.lat(), latLng.lng());
    }

    async function initMap() {
  // Import the AdvancedMarkerElement class
  const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");

  const fallback = { lat: 12.9716, lng: 77.5946 };

  function createMap(center) {
    map = new google.maps.Map(document.getElementById("map"), {
      center: center,
      zoom: 14,
      streetViewControl: false,
      mapTypeControl: false,
    });

    marker = new AdvancedMarkerElement({
      position: center,
      map,
      draggable: true,
    });

    setLatLng(center.lat, center.lng);

    map.addListener("click", (e) => {
      marker.position = e.latLng;
      setLatLng(e.latLng.lat(), e.latLng.lng());
    });

    marker.addEventListener("dragend", () => {
      const pos = marker.position;
      setLatLng(pos.lat(), pos.lng());
    });
  }

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => createMap({
        lat: position.coords.latitude,
        lng: position.coords.longitude,
      }),
      () => createMap(fallback)
    );
  } else {
    createMap(fallback);
  }
}

    document.addEventListener("DOMContentLoaded", () => {
      initMap();

      const form = document.getElementById("helpRequestForm");
      const alertBox = document.getElementById("formAlert");

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        if (!form.checkValidity()) {
          showAlert("Please fill all required fields.", "danger");
          form.classList.add("was-validated");
          return;
        }

        const payload = {
          title: form.title.value.trim(),
          description: form.description.value.trim(),
          category: form.category.value,
          contact: form.contact.value.trim(),
          address: form.address.value.trim(),
          latitude: form.latitude.value,
          longitude: form.longitude.value,
          status: "open",
          timestamp: new Date().toISOString(),
        };

        // TODO: Implement backend API call here
        console.log("Submitting request:", payload);
        showAlert(
          "Your request has been submitted (demo). Wire this to your backend next.",
          "success"
        );
        form.reset();
      });

      document.getElementById("resetBtn").addEventListener("click", () => {
        showAlert("", "");
        form.classList.remove("was-validated");
      });

      function showAlert(message, type) {
        if (!message) {
          alertBox.className = "alert d-none";
          alertBox.textContent = "";
          return;
        }
        alertBox.className = "alert alert-" + type;
        alertBox.textContent = message;
      }
    });
  </script>
  <script
    async
    defer
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=marker"
  ></script>
</body>
</html>
